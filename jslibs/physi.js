window.Physijs=function(){"use strict";var t,e,i,s,o,n,r,h,a,p=c,c={},d=new THREE.Vector3,y=new THREE.Vector3,u=new THREE.Matrix4,l=new THREE.Quaternion,_={WORLDREPORT:0,COLLISIONREPORT:1,VEHICLEREPORT:2,CONSTRAINTREPORT:3},x=14,f=5,b=9,m=6;return c.scripts={},e=function(){this._eventListeners={}},e.prototype.addEventListener=function(t,e){this._eventListeners.hasOwnProperty(t)||(this._eventListeners[t]=[]),this._eventListeners[t].push(e)},e.prototype.removeEventListener=function(t,e){var i;return this._eventListeners.hasOwnProperty(t)&&(i=this._eventListeners[t].indexOf(e))>=0?(this._eventListeners[t].splice(i,1),!0):!1},e.prototype.dispatchEvent=function(t){var e,i=Array.prototype.splice.call(arguments,1);if(this._eventListeners.hasOwnProperty(t))for(e=0;e<this._eventListeners[t].length;e++)this._eventListeners[t][e].apply(this,i)},e.make=function(t){t.prototype.addEventListener=e.prototype.addEventListener,t.prototype.removeEventListener=e.prototype.removeEventListener,t.prototype.dispatchEvent=e.prototype.dispatchEvent},i=function(){var t=1;return function(){return t++}}(),s=function(t,e,i,s){return new THREE.Vector3(Math.atan2(2*(t*s-e*i),s*s-t*t-e*e+i*i),Math.asin(2*(t*i+e*s)),Math.atan2(2*(i*s-t*e),s*s+t*t-e*e-i*i))},o=function(t,e,i){var s,o,n,r,h,a,p,c;return s=Math.cos(e),o=Math.sin(e),n=Math.cos(-i),r=Math.sin(-i),h=Math.cos(t),a=Math.sin(t),p=s*n,c=o*r,{w:p*h-c*a,x:p*a+c*h,y:o*n*h+s*r*a,z:s*r*h-o*n*a}},n=function(t,e){return u.identity(),u.identity().makeRotationFromQuaternion(e.quaternion),u.getInverse(u),d.copy(t),y.copy(e.position),d.sub(y).applyMatrix4(u)},c.noConflict=function(){return window.Physijs=p,c},c.createMaterial=function(t,e,i){var s=function(){};return s.prototype=t,s=new s,s._physijs={id:t.id,friction:void 0===e?.8:e,restitution:void 0===i?.2:i},s},c.PointConstraint=function(t,e,s){void 0===s&&(s=e,e=void 0),this.type="point",this.appliedImpulse=0,this.id=i(),this.objecta=t._physijs.id,this.positiona=n(s,t).clone(),e&&(this.objectb=e._physijs.id,this.positionb=n(s,e).clone())},c.PointConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb}},c.HingeConstraint=function(t,e,s,o){void 0===o&&(o=s,s=e,e=void 0),this.type="hinge",this.appliedImpulse=0,this.id=i(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=n(s,t).clone(),this.position=s.clone(),this.axis=o,e&&(this.objectb=e._physijs.id,this.positionb=n(s,e).clone())},c.HingeConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}},c.HingeConstraint.prototype.setLimits=function(t,e,i,s){this.scene.execute("hinge_setLimits",{constraint:this.id,low:t,high:e,bias_factor:i,relaxation_factor:s})},c.HingeConstraint.prototype.enableAngularMotor=function(t,e){this.scene.execute("hinge_enableAngularMotor",{constraint:this.id,velocity:t,acceleration:e})},c.HingeConstraint.prototype.disableMotor=function(t,e){this.scene.execute("hinge_disableMotor",{constraint:this.id})},c.SliderConstraint=function(t,e,s,o){void 0===o&&(o=s,s=e,e=void 0),this.type="slider",this.appliedImpulse=0,this.id=i(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=n(s,t).clone(),this.axis=o,e&&(this.objectb=e._physijs.id,this.positionb=n(s,e).clone())},c.SliderConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}},c.SliderConstraint.prototype.setLimits=function(t,e,i,s){this.scene.execute("slider_setLimits",{constraint:this.id,lin_lower:t,lin_upper:e,ang_lower:i,ang_upper:s})},c.SliderConstraint.prototype.setRestitution=function(t,e){this.scene.execute("slider_setRestitution",{constraint:this.id,linear:t,angular:e})},c.SliderConstraint.prototype.enableLinearMotor=function(t,e){this.scene.execute("slider_enableLinearMotor",{constraint:this.id,velocity:t,acceleration:e})},c.SliderConstraint.prototype.disableLinearMotor=function(){this.scene.execute("slider_disableLinearMotor",{constraint:this.id})},c.SliderConstraint.prototype.enableAngularMotor=function(t,e){this.scene.execute("slider_enableAngularMotor",{constraint:this.id,velocity:t,acceleration:e})},c.SliderConstraint.prototype.disableAngularMotor=function(){this.scene.execute("slider_disableAngularMotor",{constraint:this.id})},c.ConeTwistConstraint=function(t,e,s){if(void 0===s)throw"Both objects must be defined in a ConeTwistConstraint.";this.type="conetwist",this.appliedImpulse=0,this.id=i(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=n(s,t).clone(),this.objectb=e._physijs.id,this.positionb=n(s,e).clone(),this.axisa={x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},this.axisb={x:e.rotation.x,y:e.rotation.y,z:e.rotation.z}},c.ConeTwistConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}},c.ConeTwistConstraint.prototype.setLimit=function(t,e,i){this.scene.execute("conetwist_setLimit",{constraint:this.id,x:t,y:e,z:i})},c.ConeTwistConstraint.prototype.enableMotor=function(){this.scene.execute("conetwist_enableMotor",{constraint:this.id})},c.ConeTwistConstraint.prototype.setMaxMotorImpulse=function(t){this.scene.execute("conetwist_setMaxMotorImpulse",{constraint:this.id,max_impulse:t})},c.ConeTwistConstraint.prototype.setMotorTarget=function(t){t instanceof THREE.Vector3?t=(new THREE.Quaternion).setFromEuler(new THREE.Euler(t.x,t.y,t.z)):t instanceof THREE.Euler?t=(new THREE.Quaternion).setFromEuler(t):t instanceof THREE.Matrix4&&(t=(new THREE.Quaternion).setFromRotationMatrix(t)),this.scene.execute("conetwist_setMotorTarget",{constraint:this.id,x:t.x,y:t.y,z:t.z,w:t.w})},c.ConeTwistConstraint.prototype.disableMotor=function(){this.scene.execute("conetwist_disableMotor",{constraint:this.id})},c.DOFConstraint=function(t,e,s){void 0===s&&(s=e,e=void 0),this.type="dof",this.appliedImpulse=0,this.id=i(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=n(s,t).clone(),this.axisa={x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},e&&(this.objectb=e._physijs.id,this.positionb=n(s,e).clone(),this.axisb={x:e.rotation.x,y:e.rotation.y,z:e.rotation.z})},c.DOFConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}},c.DOFConstraint.prototype.setLinearLowerLimit=function(t){this.scene.execute("dof_setLinearLowerLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},c.DOFConstraint.prototype.setLinearUpperLimit=function(t){this.scene.execute("dof_setLinearUpperLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},c.DOFConstraint.prototype.setAngularLowerLimit=function(t){this.scene.execute("dof_setAngularLowerLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},c.DOFConstraint.prototype.setAngularUpperLimit=function(t){this.scene.execute("dof_setAngularUpperLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},c.DOFConstraint.prototype.enableAngularMotor=function(t){this.scene.execute("dof_enableAngularMotor",{constraint:this.id,which:t})},c.DOFConstraint.prototype.configureAngularMotor=function(t,e,i,s,o){this.scene.execute("dof_configureAngularMotor",{constraint:this.id,which:t,low_angle:e,high_angle:i,velocity:s,max_force:o})},c.DOFConstraint.prototype.disableAngularMotor=function(t){this.scene.execute("dof_disableAngularMotor",{constraint:this.id,which:t})},c.Scene=function(i){var s=this;e.call(this),THREE.Scene.call(this),this._worker=new Worker(c.scripts.worker||"physijs_worker.js"),this._worker.transferableMessage=this._worker.webkitPostMessage||this._worker.postMessage,this._materials_ref_counts={},this._objects={},this._vehicles={},this._constraints={},this._is_simulating=!1;var o=new ArrayBuffer(1);this._worker.transferableMessage(o,[o]),t=0===o.byteLength,this._worker.onmessage=function(t){var e,i=t.data;if(i instanceof ArrayBuffer&&1!==i.byteLength&&(i=new Float32Array(i)),i instanceof Float32Array)switch(i[0]){case _.WORLDREPORT:s._updateScene(i);break;case _.COLLISIONREPORT:s._updateCollisions(i);break;case _.VEHICLEREPORT:s._updateVehicles(i);break;case _.CONSTRAINTREPORT:s._updateConstraints(i)}else if(i.cmd)switch(i.cmd){case"objectReady":e=i.params,s._objects[e]&&s._objects[e].dispatchEvent("ready");break;case"worldReady":s.dispatchEvent("ready");break;case"vehicle":window.test=i;break;default:console.debug("Received: "+i.cmd),console.dir(i.params)}else switch(i[0]){case _.WORLDREPORT:s._updateScene(i);break;case _.COLLISIONREPORT:s._updateCollisions(i);break;case _.VEHICLEREPORT:s._updateVehicles(i);break;case _.CONSTRAINTREPORT:s._updateConstraints(i)}},i=i||{},i.ammo=c.scripts.ammo||"ammo.js",i.fixedTimeStep=i.fixedTimeStep||1/60,i.rateLimit=i.rateLimit||!0,this.execute("init",i),console.log(this._worker)},c.Scene.prototype=new THREE.Scene,c.Scene.prototype.constructor=c.Scene,e.make(c.Scene),c.Scene.prototype._updateScene=function(e){var i,s,o,n=e[1];for(s=0;n>s;s++)o=2+s*x,i=this._objects[e[o]],void 0!==i&&(i.__dirtyPosition===!1&&i.position.set(e[o+1],e[o+2],e[o+3]),i.__dirtyRotation===!1&&i.quaternion.set(e[o+4],e[o+5],e[o+6],e[o+7]),i._physijs.linearVelocity.set(e[o+8],e[o+9],e[o+10]),i._physijs.angularVelocity.set(e[o+11],e[o+12],e[o+13]));t&&this._worker.transferableMessage(e.buffer,[e.buffer]),this._is_simulating=!1,this.dispatchEvent("update")},c.Scene.prototype._updateVehicles=function(e){var i,s,o,n;for(o=0;o<(e.length-1)/b;o++)n=1+o*b,i=this._vehicles[e[n]],void 0!==i&&(s=i.wheels[e[n+1]],s.position.set(e[n+2],e[n+3],e[n+4]),s.quaternion.set(e[n+5],e[n+6],e[n+7],e[n+8]));t&&this._worker.transferableMessage(e.buffer,[e.buffer])},c.Scene.prototype._updateConstraints=function(e){var i,s,o,n;for(o=0;o<(e.length-1)/m;o++)n=1+o*m,i=this._constraints[e[n]],s=this._objects[e[n+1]],void 0!==i&&void 0!==s&&(d.set(e[n+2],e[n+3],e[n+4]),u.extractRotation(s.matrix),d.applyMatrix4(u),i.positiona.addVectors(s.position,d),i.appliedImpulse=e[n+5]);t&&this._worker.transferableMessage(e.buffer,[e.buffer])},c.Scene.prototype._updateCollisions=function(e){var i,s,o,n,r,p,c,y={},u={};for(i=0;i<e[1];i++)o=2+i*f,n=e[o],r=e[o+1],u[n+"-"+r]=o+2,u[r+"-"+n]=-1*(o+2),y[n]||(y[n]=[]),y[n].push(r),y[r]||(y[r]=[]),y[r].push(n);for(p in this._objects)if(this._objects.hasOwnProperty(p))if(n=this._objects[p],y[p]){for(s=0;s<n._physijs.touches.length;s++)-1===y[p].indexOf(n._physijs.touches[s])&&n._physijs.touches.splice(s--,1);for(s=0;s<y[p].length;s++)if(c=y[p][s],r=this._objects[c],r&&-1===n._physijs.touches.indexOf(c)){n._physijs.touches.push(c),d.subVectors(n.getLinearVelocity(),r.getLinearVelocity()),h=d.clone(),d.subVectors(n.getAngularVelocity(),r.getAngularVelocity()),a=d.clone();var l=u[n._physijs.id+"-"+r._physijs.id];l>0?d.set(-e[l],-e[l+1],-e[l+2]):(l*=-1,d.set(e[l],e[l+1],e[l+2])),n.dispatchEvent("collision",r,h,a,d)}}else n._physijs.touches.length=0;this.collisions=y,t&&this._worker.transferableMessage(e.buffer,[e.buffer])},c.Scene.prototype.addConstraint=function(t,e){if(this._constraints[t.id]=t,this.execute("addConstraint",t.getDefinition()),e){var i;switch(t.type){case"point":i=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial),i.position.copy(t.positiona),this._objects[t.objecta].add(i);break;case"hinge":i=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial),i.position.copy(t.positiona),this._objects[t.objecta].add(i);break;case"slider":i=new THREE.Mesh(new THREE.BoxGeometry(10,1,1),new THREE.MeshNormalMaterial),i.position.copy(t.positiona),i.rotation.set(t.axis.y,t.axis.x,t.axis.z),this._objects[t.objecta].add(i);break;case"conetwist":i=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial),i.position.copy(t.positiona),this._objects[t.objecta].add(i);break;case"dof":i=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial),i.position.copy(t.positiona),this._objects[t.objecta].add(i)}}return t},c.Scene.prototype.onSimulationResume=function(){this.execute("onSimulationResume",{})},c.Scene.prototype.removeConstraint=function(t){void 0!==this._constraints[t.id]&&(this.execute("removeConstraint",{id:t.id}),delete this._constraints[t.id])},c.Scene.prototype.execute=function(t,e){this._worker.postMessage({cmd:t,params:e})},r=function(t,e){var i;for(i=0;i<e.children.length;i++)e.children[i]._physijs&&(e.children[i].updateMatrix(),e.children[i].updateMatrixWorld(),d.setFromMatrixPosition(e.children[i].matrixWorld),l.setFromRotationMatrix(e.children[i].matrixWorld),e.children[i]._physijs.position_offset={x:d.x,y:d.y,z:d.z},e.children[i]._physijs.rotation={x:l.x,y:l.y,z:l.z,w:l.w},t._physijs.children.push(e.children[i]._physijs)),r(t,e.children[i])},c.Scene.prototype.add=function(t){if(THREE.Mesh.prototype.add.call(this,t),t._physijs)if(t.world=this,t instanceof c.Vehicle)this.add(t.mesh),this._vehicles[t._physijs.id]=t,this.execute("addVehicle",t._physijs);else{t.__dirtyPosition=!1,t.__dirtyRotation=!1,this._objects[t._physijs.id]=t,t.children.length&&(t._physijs.children=[],r(t,t)),t.material._physijs&&(this._materials_ref_counts.hasOwnProperty(t.material._physijs.id)?this._materials_ref_counts[t.material._physijs.id]++:(this.execute("registerMaterial",t.material._physijs),t._physijs.materialId=t.material._physijs.id,this._materials_ref_counts[t.material._physijs.id]=1)),t._physijs.position={x:t.position.x,y:t.position.y,z:t.position.z},t._physijs.rotation={x:t.quaternion.x,y:t.quaternion.y,z:t.quaternion.z,w:t.quaternion.w};new THREE.Vector3(1,1,1);t._physijs.width&&(t._physijs.width*=t.scale.x),t._physijs.height&&(t._physijs.height*=t.scale.y),t._physijs.depth&&(t._physijs.depth*=t.scale.z),this.execute("addObject",t._physijs)}},c.Scene.prototype.remove=function(t){if(t instanceof c.Vehicle){for(this.execute("removeVehicle",{id:t._physijs.id});t.wheels.length;)this.remove(t.wheels.pop());this.remove(t.mesh),delete this._vehicles[t._physijs.id]}else THREE.Mesh.prototype.remove.call(this,t),t._physijs&&(delete this._objects[t._physijs.id],this.execute("removeObject",{id:t._physijs.id}));t.material&&t.material._physijs&&this._materials_ref_counts.hasOwnProperty(t.material._physijs.id)&&(this._materials_ref_counts[t.material._physijs.id]--,0==this._materials_ref_counts[t.material._physijs.id]&&(this.execute("unRegisterMaterial",t.material._physijs),delete this._materials_ref_counts[t.material._physijs.id]))},c.Scene.prototype.setFixedTimeStep=function(t){t&&this.execute("setFixedTimeStep",t)},c.Scene.prototype.setGravity=function(t){t&&this.execute("setGravity",t)},c.Scene.prototype.simulate=function(t,e){var i,s,o;if(this._is_simulating)return!1;this._is_simulating=!0;for(i in this._objects)this._objects.hasOwnProperty(i)&&(s=this._objects[i],(s.__dirtyPosition||s.__dirtyRotation)&&(o={id:s._physijs.id},s.__dirtyPosition&&(o.pos={x:s.position.x,y:s.position.y,z:s.position.z},s.__dirtyPosition=!1),s.__dirtyRotation&&(o.quat={x:s.quaternion.x,y:s.quaternion.y,z:s.quaternion.z,w:s.quaternion.w},s.__dirtyRotation=!1),this.execute("updateTransform",o)));return this.execute("simulate",{timeStep:t,maxSubSteps:e}),!0},c.Mesh=function(t,s,o){t&&(e.call(this),THREE.Mesh.call(this,t,s),t.boundingBox||t.computeBoundingBox(),this._physijs={type:null,id:i(),mass:o||0,touches:[],linearVelocity:new THREE.Vector3,angularVelocity:new THREE.Vector3})},c.Mesh.prototype=new THREE.Mesh,c.Mesh.prototype.constructor=c.Mesh,e.make(c.Mesh),c.Mesh.prototype.__defineGetter__("mass",function(){return this._physijs.mass}),c.Mesh.prototype.__defineSetter__("mass",function(t){this._physijs.mass=t,this.world&&this.world.execute("updateMass",{id:this._physijs.id,mass:t})}),c.Mesh.prototype.applyCentralImpulse=function(t){this.world&&this.world.execute("applyCentralImpulse",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},c.Mesh.prototype.applyImpulse=function(t,e){this.world&&this.world.execute("applyImpulse",{id:this._physijs.id,impulse_x:t.x,impulse_y:t.y,impulse_z:t.z,x:e.x,y:e.y,z:e.z})},c.Mesh.prototype.applyTorque=function(t){this.world&&this.world.execute("applyTorque",{id:this._physijs.id,torque_x:t.x,torque_y:t.y,torque_z:t.z})},c.Mesh.prototype.applyCentralForce=function(t){this.world&&this.world.execute("applyCentralForce",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},c.Mesh.prototype.applyForce=function(t,e){this.world&&this.world.execute("applyForce",{id:this._physijs.id,force_x:t.x,force_y:t.y,force_z:t.z,x:e.x,y:e.y,z:e.z})},c.Mesh.prototype.getAngularVelocity=function(){return this._physijs.angularVelocity},c.Mesh.prototype.setAngularVelocity=function(t){this.world&&this.world.execute("setAngularVelocity",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},c.Mesh.prototype.getLinearVelocity=function(){return this._physijs.linearVelocity},c.Mesh.prototype.setLinearVelocity=function(t){this.world&&this.world.execute("setLinearVelocity",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},c.Mesh.prototype.setAngularFactor=function(t){this.world&&this.world.execute("setAngularFactor",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},c.Mesh.prototype.setLinearFactor=function(t){this.world&&this.world.execute("setLinearFactor",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},c.Mesh.prototype.setDamping=function(t,e){this.world&&this.world.execute("setDamping",{id:this._physijs.id,linear:t,angular:e})},c.Mesh.prototype.setCcdMotionThreshold=function(t){this.world&&this.world.execute("setCcdMotionThreshold",{id:this._physijs.id,threshold:t})},c.Mesh.prototype.setCcdSweptSphereRadius=function(t){this.world&&this.world.execute("setCcdSweptSphereRadius",{id:this._physijs.id,radius:t})},c.PlaneMesh=function(t,e,i){var s,o;c.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,this._physijs.type="plane",this._physijs.normal=t.faces[0].normal.clone(),this._physijs.mass="undefined"==typeof i?s*o:i},c.PlaneMesh.prototype=new c.Mesh,c.PlaneMesh.prototype.constructor=c.PlaneMesh,c.HeightfieldMesh=function(t,e,i,s,o){c.Mesh.call(this,t,e,i),this._physijs.type="heightfield",this._physijs.xsize=t.boundingBox.max.x-t.boundingBox.min.x,this._physijs.ysize=t.boundingBox.max.y-t.boundingBox.min.y,this._physijs.xpts="undefined"==typeof s?Math.sqrt(t.vertices.length):s+1,this._physijs.ypts="undefined"==typeof o?Math.sqrt(t.vertices.length):o+1,this._physijs.absMaxHeight=Math.max(t.boundingBox.max.z,Math.abs(t.boundingBox.min.z));for(var n,r,h=[],a=0;a<t.vertices.length;a++)n=a%this._physijs.xpts,r=Math.round(a/this._physijs.xpts-a%this._physijs.xpts/this._physijs.xpts),h[a]=t.vertices[n+(this._physijs.ypts-r-1)*this._physijs.ypts].z;this._physijs.points=h},c.HeightfieldMesh.prototype=new c.Mesh,c.HeightfieldMesh.prototype.constructor=c.HeightfieldMesh,c.BoxMesh=function(t,e,i){var s,o,n;c.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,n=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="box",this._physijs.width=s,this._physijs.height=o,this._physijs.depth=n,this._physijs.mass="undefined"==typeof i?s*o*n:i},c.BoxMesh.prototype=new c.Mesh,c.BoxMesh.prototype.constructor=c.BoxMesh,c.SphereMesh=function(t,e,i){c.Mesh.call(this,t,e,i),t.boundingSphere||t.computeBoundingSphere(),this._physijs.type="sphere",this._physijs.radius=t.boundingSphere.radius,this._physijs.mass="undefined"==typeof i?4/3*Math.PI*Math.pow(this._physijs.radius,3):i},c.SphereMesh.prototype=new c.Mesh,c.SphereMesh.prototype.constructor=c.SphereMesh,c.CylinderMesh=function(t,e,i){var s,o,n;c.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,n=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="cylinder",this._physijs.width=s,this._physijs.height=o,this._physijs.depth=n,this._physijs.mass="undefined"==typeof i?s*o*n:i},c.CylinderMesh.prototype=new c.Mesh,c.CylinderMesh.prototype.constructor=c.CylinderMesh,c.CapsuleMesh=function(t,e,i){var s,o,n;c.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,n=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="capsule",this._physijs.radius=Math.max(s/2,n/2),this._physijs.height=o,this._physijs.mass="undefined"==typeof i?s*o*n:i},c.CapsuleMesh.prototype=new c.Mesh,c.CapsuleMesh.prototype.constructor=c.CapsuleMesh,c.ConeMesh=function(t,e,i){var s,o;c.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,this._physijs.type="cone",this._physijs.radius=s/2,this._physijs.height=o,this._physijs.mass="undefined"==typeof i?s*o:i},c.ConeMesh.prototype=new c.Mesh,c.ConeMesh.prototype.constructor=c.ConeMesh,c.ConcaveMesh=function(t,e,i,s,o){var n,r,h,a,p,d,y=s?s:t,u=new Array(y.faces.length);for(c.Mesh.call(this,t,e,i),y.boundingBox||y.computeBoundingBox(),o=o||{x:1,y:1,z:1},o.x=o.x||1,o.y=o.y||1,o.z=o.z||1,p=y.vertices,n=0;n<y.faces.length;n++)d=y.faces[n],u[n]=[{x:p[d.a].x*o.x,y:p[d.a].y*o.y,z:p[d.a].z*o.z},{x:p[d.b].x*o.x,y:p[d.b].y*o.y,z:p[d.b].z*o.z},{x:p[d.c].x*o.x,y:p[d.c].y*o.y,z:p[d.c].z*o.z}];r=y.boundingBox.max.x-y.boundingBox.min.x,h=y.boundingBox.max.y-y.boundingBox.min.y,a=y.boundingBox.max.z-y.boundingBox.min.z,this._physijs.type="concave",this._physijs.triangles=u,this._physijs.mass="undefined"==typeof i?r*h*a:i},c.ConcaveMesh.prototype=new c.Mesh,c.ConcaveMesh.prototype.constructor=c.ConcaveMesh,c.ConvexMesh=function(t,e,i){var s,o,n,r,h=[];for(c.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=0;s<t.vertices.length;s++)h.push({x:t.vertices[s].x,y:t.vertices[s].y,z:t.vertices[s].z});o=t.boundingBox.max.x-t.boundingBox.min.x,n=t.boundingBox.max.y-t.boundingBox.min.y,r=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="convex",this._physijs.points=h,this._physijs.mass="undefined"==typeof i?o*n*r:i},c.ConvexMesh.prototype=new c.Mesh,c.ConvexMesh.prototype.constructor=c.ConvexMesh,c.Vehicle=function(t,e){e=e||new c.VehicleTuning,this.mesh=t,this.wheels=[],this._physijs={id:i(),rigidBody:t._physijs.id,suspension_stiffness:e.suspension_stiffness,suspension_compression:e.suspension_compression,suspension_damping:e.suspension_damping,max_suspension_travel:e.max_suspension_travel,friction_slip:e.friction_slip,max_suspension_force:e.max_suspension_force}},c.Vehicle.prototype.addWheel=function(t,e,i,s,o,n,r,h,a){var p=new THREE.Mesh(t,e);p.castShadow=p.receiveShadow=!0,p.position.copy(s).multiplyScalar(n/100).add(i),this.world.add(p),this.wheels.push(p),this.world.execute("addWheel",{id:this._physijs.id,connection_point:{x:i.x,y:i.y,z:i.z},wheel_direction:{x:s.x,y:s.y,z:s.z},wheel_axle:{x:o.x,y:o.y,z:o.z},suspension_rest_length:n,wheel_radius:r,is_front_wheel:h,tuning:a})},c.Vehicle.prototype.setSteering=function(t,e){if(void 0!==e&&void 0!==this.wheels[e])this.world.execute("setSteering",{id:this._physijs.id,wheel:e,steering:t});else if(this.wheels.length>0)for(var i=0;i<this.wheels.length;i++)this.world.execute("setSteering",{id:this._physijs.id,wheel:i,steering:t})},c.Vehicle.prototype.setBrake=function(t,e){if(void 0!==e&&void 0!==this.wheels[e])this.world.execute("setBrake",{id:this._physijs.id,wheel:e,brake:t});else if(this.wheels.length>0)for(var i=0;i<this.wheels.length;i++)this.world.execute("setBrake",{id:this._physijs.id,wheel:i,brake:t})},c.Vehicle.prototype.applyEngineForce=function(t,e){if(void 0!==e&&void 0!==this.wheels[e])this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:e,force:t});else if(this.wheels.length>0)for(var i=0;i<this.wheels.length;i++)this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:i,force:t})},c.VehicleTuning=function(t,e,i,s,o,n){this.suspension_stiffness=void 0!==t?t:5.88,this.suspension_compression=void 0!==e?e:.83,this.suspension_damping=void 0!==i?i:.88,this.max_suspension_travel=void 0!==s?s:500,this.friction_slip=void 0!==o?o:10.5,this.max_suspension_force=void 0!==n?n:6e3},c}();